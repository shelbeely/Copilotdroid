Refactor architecture and harden code.